@page "/ollama-models"
@using System.Net.Http.Json
@inject HttpClient Http

<h3>Ollama Local Models</h3>

@if (isLoading)
{
    <p>Loading models...</p>
}
else if (errorMessage != null)
{
    <p class="text-danger">Error: @errorMessage</p>
}
else
{
    <label for="modelSelect">Select a model:</label>
    <select id="modelSelect" @bind="selectedModel">
        @foreach (var model in models)
        {
            <option value="@model">@model</option>
        }
    </select>
    <button class="btn btn-primary" @onclick="LoadModels">Refresh</button>
}

@code {
    List<string> models = new();
    string? selectedModel;
    bool isLoading = true;
    string? errorMessage;

    protected override async Task OnInitializedAsync()
    {
        await LoadModels();
    }

    async Task LoadModels()
    {
        isLoading = true;
        errorMessage = null;
        try
        {
            var response = await Http.GetFromJsonAsync<OllamaTagsResponse>("http://localhost:11434/api/tags");
            models = response?.models?.Select(m => m.name).ToList() ?? new List<string>();
            if (models.Count > 0)
                selectedModel = models[0];
        }
        catch (Exception ex)
        {
            errorMessage = ex.Message;
        }
        isLoading = false;
    }

    public class OllamaTagsResponse
    {
        public List<OllamaModel> models { get; set; } = new();
    }
    public class OllamaModel
    {
        public string name { get; set; } = string.Empty;
    }
}
